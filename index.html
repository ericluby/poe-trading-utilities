<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>PoE DivCard Margins</title>
  </head>
  <body>
    <h1>PoE DivCard Margins</h1>
    <p>Here is a table of Divination Cards and their prices compared to the prices of the items they make.</p>
    <table>
      <tbody>
        <tr>
          <!-- 7 columns in the table -->
          <th onclick="sortBy('cardName')">Div Card Name</th>
          <th onclick="sortBy('cardChaos')">Div Card Price</th>
          <th onclick="sortBy('cardStack')">Div Card Stacksize</th>
          <th onclick="sortBy('stackChaos')">Div Card Stack Price</th>
          <th onclick="sortBy('itemName')">Item Name</th>
          <th onclick="sortBy('itemChaos')">Item Price</th>
          <th onclick="sortBy('profitMargin')">Profit Margin</th>
        </tr>
      </tbody>
    </table>
    <script type="text/javascript">
      function sortBy (key){
        alert("you clicked me!" + key);
        divCardResponseJson.sort(function (a,b){
          return a[key] > b[key] ? 1:-1;
        });
        renderTable();
      };
      async function main(){
        const serverURL = "http://localhost:3000/divitems"
        divCardResponseJson = await fetch(serverURL).then(res => res.json());
        console.log("divCardResponseJson", divCardResponseJson);
        renderTable();
      }
      function renderTable () {
        document.body.querySelectorAll(".divCardData")
        .forEach((element, i) => {
          element.parentNode.removeChild(element);
        });
        const rowStrings = divCardResponseJson.map(function(divCardData){
          const itemRow = `<tr class="divCardData">
            <td>${divCardData.cardName}</td>
            <td>${divCardData.cardChaos}</td>
            <td>${divCardData.cardStack}</td>
            <td>${divCardData.stackChaos}</td>
            <td>${divCardData.itemName}</td>
            <td>${divCardData.itemChaos}</td>
            <td>${divCardData.profitMargin}</td>
          </tr>`;
          return itemRow;
        });
        const tbodyEl = document.body.querySelector('tbody');
        tbodyEl.innerHTML += rowStrings.join('\n');
      }
      main();
      let divCardResponseJson = [];
    </script>
  </body>
</html>
