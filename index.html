<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>PoE DivCard Margins</title>
  </head>
  <body>
    <h1>PoE DivCard Margins</h1>
    <p>Here is a table of Divination Cards and their prices compared to the prices of the items they make.</p>
    <table>
      <tbody>
        <tr>
          <!-- 7 columns in the table -->
          <th onclick="clickHandler('matchingUniqueDivCard.name')">Div Card Name</th>
          <th onclick="clickHandler('matchingUniqueDivCard.chaos')">Div Card Price</th>
          <th>Div Card Stacksize</th>
          <th>Div Card Stack Price</th>
          <th>Item Name</th>
          <th>Item Price</th>
          <th>Profit Margin</th>
        </tr>
      </tbody>
    </table>
    <script type="text/javascript">
      function clickHandler (path){
        alert("you clicked me!" + path);
        divCardResponseJson.sort(function (a,b){
          return a[path] > b[path] ? 1:-1;
        });
        renderTable();
      };
      async function main(){
        const serverURL = "http://localhost:3000/divitems"
        divCardResponseJson = await fetch(serverURL).then(res => res.json());
        console.log("divCardResponseJson", divCardResponseJson);
        renderTable();
      }
      function renderTable () {
        document.body.querySelectorAll(".divCardData")
        .forEach((element, i) => {
          element.parentNode.removeChild(element);
        });
        const rowStrings = divCardResponseJson.map(function(divCardData){
          const itemRow = `<tr class="divCardData">
            <td>${divCardData.matchingUniqueDivCard.name}</td>
            <td>${divCardData.matchingUniqueDivCard.chaos}</td>
            <td>${divCardData.matchingUniqueDivCard.stackSize}</td>
            <td>${divCardData.divCardStackPrice}</td>
            <td>${divCardData.combinedItem.name}</td>
            <td>${divCardData.combinedItem.chaos}</td>
            <td>${divCardData.profitMargin}</td>
          </tr>`;
          return itemRow;
        });
        const tbodyEl = document.body.querySelector('tbody');
        tbodyEl.innerHTML += rowStrings.join('\n');
      }
      main();
      let divCardResponseJson = [];
    </script>
  </body>
</html>
